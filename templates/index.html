<!DOCTYPE html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, width=device-width, height=device-height, shrink-to-fit=no" />
    <title>OpenAI APress-Test</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='dog.png') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}" />
  </head>

  <body>
    <div class="container">
      <div class="head">
        <div class="line">
          <button type="button" class="btn act" onclick="presetModel(this)">text</button>
          <button type="button" class="btn" onclick="presetModel(this)">java</button>
          <button type="button" class="btn" onclick="presetModel(this)">python</button>
          <button type="button" class="btn" onclick="presetModel(this)">js</button>
          <button type="button" class="btn" onclick="presetModel(this)">img</button>
        </div>
        <form action="/" method="post">
          <div class="addedSet line hidden">
            <span class="label">модель:
              <select name="style">
                <option value="Cartoon">Cartoon</option>
                <option value="Realistic">Realistic</option>
                <option value="Abstract">Abstract</option>
                <option value="Mosaic">Mosaic</option>
              </select>
            </span>
            <span class="label">сколько шт.:
              <select name="Pics" class="settings"></select>
            </span>
            <span class="label">мощность:
              <select name="Deep" class="settings"></select>
            </span>
            <span class="label">загр. образец
              <button type="button" class="btn" onclick="presetModel(this)">upload</button>
            </span>
          </div>
          
          
          <textarea name="query" id="query" placeholder="вопросик" required></textarea>
          <input type="hidden" name="model" value="text"/>
          <input type="submit" value="Go!" />
        </form>  

      {% if query %}
      <div class="query" onclick="cloneText(this)">{{ query }}</div>
      {% endif %}
        
      {% if result %}
      <div class="top-layer" style="justify-content: flex-end;">
        <button type="button" class="btn copy" onclick="copyClipBoard(this)">copy</button>
      </div>
      <textarea id="result"></textarea>
      </div>
      <div id="hidden">{{ result }}</div>
      {% else %}
      <img src="{{ link }}" id="result" class="result">
      </div>
      <div id="hidden">img</div>
      {% endif %}
      
    </div>
    
    <script>
      
      function auto_grow(element) {
        element.style.height = "0px";
        element.style.height = (element.scrollHeight)+"px";
      }
      
      function presetModel(element){
        document.querySelector('input[type="hidden"]').value=element.innerHTML;
        document.querySelectorAll('button').forEach(el => el.classList.remove('act'));
        element.classList.add('act');
        if (element.innerHTML=="img") {
          document.querySelector(".addedSet").classList.remove("hidden")
        } else {document.querySelector(".addedSet").classList.add("hidden")}
      }
      
      function cloneText(element){
        document.getElementById("query").value=element.innerHTML;
        element.style.height = (element.scrollHeight)+"px";
      }
      
      function copyClipBoard(element) {
        navigator.clipboard.writeText(textResult);
        element.innerHTML("ok")
      } 

      var textResult = document.getElementById("hidden").innerHTML.replace(". ",".\n");
      var query = document.getElementById("query");
      var result = document.getElementById("result");

      if (textResult != "img") {
        textResult = textResult.replace(/&amp;/g, "&").replace(/\&[gG][tT];/g, '>').replace(/\&[lL][tT];/g, '<')
        textResult += "\n\n";
        result.value = textResult;
        auto_grow(result);
      }

      query.focus();
      const textarea = document.querySelectorAll('textarea');
      textarea.forEach(el => {el.oninput = function(event) { auto_grow(event.target) }})
      const settings = document.querySelectorAll('.settings');
      settings.forEach(el => {for (var i=1; i<10; i++) {
        option = document.createElement("option");
        option.value =  option.text = i;
        el.appendChild(option)
      }})

    </script>
      
    </div>
  </body>
</html>
